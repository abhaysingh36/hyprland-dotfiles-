#!/bin/bash

# Define wallpaper path
WALLPAPER="$HOME/.config/backgrounds/car1.png"

# Ensure wallpaper file exists
if [[ ! -f "$WALLPAPER" ]]; then
    echo "Error: Wallpaper file not found at $WALLPAPER"
    exit 1
fi

# Ensure Hyprpaper is running
if ! pgrep -u "$USER" -x "hyprpaper" > /dev/null; then
    echo "Hyprpaper is not running. Starting it now..."
    hyprpaper &
    
    # Wait until Hyprpaper starts
    for i in {1..5}; do
        if pgrep -u "$USER" -x "hyprpaper" > /dev/null; then
            break
        fi
        sleep 0.5
    done
    
    if ! pgrep -u "$USER" -x "hyprpaper" > /dev/null; then
        echo "Failed to start Hyprpaper."
        exit 1
    fi
fi

# Preload wallpaper
if ! hyprctl hyprpaper preload "$WALLPAPER"; then
    echo "Failed to preload wallpaper."
    exit 1
fi

sleep 0.2  # Ensure preloading completes

# Get active monitors and apply wallpaper
hyprctl monitors | awk '/Monitor/ {print $2}' | while read -r MONITOR; do
    if ! hyprctl hyprpaper wallpaper "$MONITOR,$WALLPAPER"; then
        echo "Failed to apply wallpaper to $MONITOR"
    fi
done

echo "Wallpaper applied to all active monitors."

